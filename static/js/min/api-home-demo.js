function rollupDatesAndValues(e,t){dataValuesForChart=["Reports"],dataLabelsForChart=["Date"];var n=d3.nest().key(function(e){return e.time.slice(0,6)}).rollup(function(e){return d3.sum(e,function(e){return e.count})}).entries(e);n.map(function(e){dataLabelsForChart.push(e.key),dataValuesForChart.push(e.values)}),t()}function processDataForCount(e,t){dataLabelsForChart=[],dataValuesForChart=["Number of matching reports"],$.each(e,function(e,t){dataLabelsForChart.push(t.term.toLowerCase()),dataValuesForChart.push(t.count)}),t()}function processDataForPrimarySource(e,t){dataValuesForChart=[],$.each(e,function(e,t){"1"==t.term?term="Physician":"2"==t.term?term="Pharmacist":"3"==t.term?term="Other HCP":"4"==t.term?term="Lawyer":"5"==t.term&&(term="Consumer or non-HCP"),dataValuesForChart.push([term,t.count])}),t()}function renderDemoChart(e){1===e?$.when($.getJSON("https://api.fda.gov/drug/event.json?search=receivedate:[20040101+TO+20150101]&count=receivedate",function(e){rollupDatesAndValues(e.results,function(){})})).then(function(){$("#title").text("Adverse drug event reports, 2004 to 2013"),$("#title").addClass("in").removeClass("out"),c3.generate({bindto:selectedChart,data:{x:"Date",x_format:"%Y%m",columns:[dataLabelsForChart,dataValuesForChart]},point:{show:!1},color:{pattern:["#fff"]},tooltip:{show:!1},axis:{x:{padding:15,type:"timeseries",tick:{format:"%Y-%m",culling:{max:10}}},y:{show:!0,tick:{culling:{max:9}}}},legend:{show:!1},size:{height:220}})}):2===e?$.when($.getJSON("https://api.fda.gov/drug/event.json?&count=patient.drug.drugindication.exact",function(e){processDataForCount(e.results.slice(0,5),function(){})})).then(function(){$("#api-home-demo #title").text("Frequently reported drug classes in adverse event reports"),$("#title").addClass("in").removeClass("out"),c3.generate({bindto:selectedChart,data:{columns:[dataValuesForChart],type:"bar"},color:{pattern:["#fff"]},bar:{width:{ratio:.25}},tooltip:{show:!1},axis:{rotated:!0,x:{type:"categorized",categories:dataLabelsForChart},y:{show:!1,ticks:{culling:{max:1}}}},size:{height:220},legend:{show:!1}})}):3===e?$.when($.getJSON("https://api.fda.gov/drug/event.json?search=patient.patientsex:2+AND+patient.patientonsetage:[55+TO+90]&count=patient.drug.drugindication.exact",function(e){processDataForCount(e.results.slice(0,5),function(){})})).then(function(){$("#api-home-demo #title").text("Frequently reported indications for drug use among women, 55 to 90"),$("#title").addClass("in").removeClass("out"),c3.generate({bindto:selectedChart,data:{columns:[dataValuesForChart],type:"bar"},color:{pattern:["#fff"]},bar:{width:{ratio:.25}},tooltip:{show:!1},axis:{rotated:!0,x:{type:"categorized",categories:dataLabelsForChart},y:{show:!0,ticks:{culling:{max:10}}}},size:{height:220},legend:{show:!1}})}):4===e&&$.when($.getJSON("https://api.fda.gov/drug/event.json?search=receivedate:[20040101+TO+20150101]+AND+patient.drug.drugindication:hypertension&count=receivedate",function(e){rollupDatesAndValues(e.results,function(){})})).then(function(){$("#title").text("Adverse drug event reports, 2004 to 2013, where an indication for use was hypertension"),$("#title").addClass("in").removeClass("out"),c3.generate({bindto:selectedChart,data:{x:"Date",x_format:"%Y%m",columns:[dataLabelsForChart,dataValuesForChart]},point:{show:!1},color:{pattern:["#fff"]},tooltip:{show:!1},axis:{x:{padding:15,type:"timeseries",tick:{format:"%Y-%m",culling:{max:10}}},y:{show:!0,tick:{culling:{max:9}}}},legend:{show:!1},size:{height:220}})})}var selectedChart=$("#api-home-demo").find("#chart")[0],dataValuesForChart=["Reports"],dataLabelsForChart=["Date"];$(document).ready(function(){var e=Math.floor(4*Math.random()+1);renderDemoChart(e),console.log(e)});